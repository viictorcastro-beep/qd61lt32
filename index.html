<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rateio 50/50 – Victor & Gustavo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"}
    .card{ @apply bg-white rounded-2xl shadow p-5; }
    .btn{ @apply px-3 py-2 rounded-xl shadow text-sm font-semibold; }
    .btn-prim{ @apply bg-black text-white hover:bg-neutral-800; }
    .btn-sec{ @apply bg-neutral-100 hover:bg-neutral-200; }
    .tag{ @apply text-xs px-2 py-1 rounded-md bg-neutral-100; }
    .input{ @apply w-full border border-neutral-300 rounded-xl px-3 py-2 text-sm; }
    .select{ @apply w-full border border-neutral-300 rounded-xl px-3 py-2 text-sm; }
    .grid-col{ @apply grid grid-cols-12 gap-3; }
    .tbl th{ @apply text-left text-xs font-semibold text-neutral-600; }
    .tbl td{ @apply text-sm; }
    .pill{ @apply rounded-full px-2.5 py-0.5 text-xs; }
    .hint{ @apply text-[11px] text-neutral-500; }
    .danger{ @apply text-red-600; }
  </style>
</head>
<body class="bg-neutral-50 min-h-screen">
  <div class="max-w-7xl mx-auto p-5 lg:p-8">
    <header class="mb-6 flex items-center justify-between">
      <h1 class="text-2xl font-bold">Rateio 50/50 — Victor & Gustavo</h1>
      <div class="flex items-center gap-2">
        <button id="btnExportCSV" class="btn btn-sec" title="Exporta os lançamentos em CSV">Exportar CSV</button>
        <label class="btn btn-sec cursor-pointer" title="Importa um CSV com o mesmo cabeçalho">
          Importar CSV
          <input id="fileImport" type="file" accept=".csv" class="hidden" />
        </label>
        <button id="btnReset" class="btn btn-sec" title="Apaga todos os dados locais (localStorage)">Zerar (local)</button>
      </div>
    </header>

    <section class="card mb-6">
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="text-xs text-neutral-500">Participante A</label>
          <input id="nameA" class="input" value="Victor" />
        </div>
        <div>
          <label class="text-xs text-neutral-500">Participante B</label>
          <input id="nameB" class="input" value="Gustavo" />
        </div>
      </div>
      <div class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="card bg-neutral-900 text-white">
          <div class="text-xs opacity-80">Total Geral</div>
          <div id="kpiTotal" class="text-2xl font-bold">R$ 0,00</div>
        </div>
        <div class="card">
          <div class="text-xs text-neutral-500">Pago — <span id="lblA">Victor</span></div>
          <div id="kpiPagoA" class="text-2xl font-bold">R$ 0,00</div>
        </div>
        <div class="card">
          <div class="text-xs text-neutral-500">Pago — <span id="lblB">Gustavo</span></div>
          <div id="kpiPagoB" class="text-2xl font-bold">R$ 0,00</div>
        </div>
        <div class="card">
          <div class="text-xs text-neutral-500">Equalização sugerida</div>
          <div class="text-sm">Se > 0, <span id="whoPays" class="font-semibold"></span> deve pagar</div>
          <div id="kpiEqual" class="text-2xl font-bold">R$ 0,00</div>
        </div>
      </div>
    </section>

    <section class="card mb-6">
      <h2 class="text-lg font-semibold mb-3">Novo Lançamento</h2>
      <div class="grid-col">
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Data</label>
          <input id="iData" type="date" class="input" />
        </div>
        <div class="col-span-12 md:col-span-4">
          <label class="text-xs text-neutral-500">Descrição</label>
          <input id="iDesc" class="input" placeholder="Ex.: Quitação terreno QD31 LT32" />
        </div>
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Categoria</label>
          <select id="iCat" class="select" aria-label="Categoria"></select>
        </div>
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Centro de Custo</label>
          <select id="iCC" class="select" aria-label="Centro de Custo"></select>
        </div>
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Valor (R$)</label>
          <input id="iValor" type="text" inputmode="decimal" class="input" placeholder="Ex.: 1.234,56" />
          <div class="hint">Use vírgula para centavos (pt-BR)</div>
        </div>

        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Pagador</label>
          <select id="iPagador" class="select" aria-label="Pagador"></select>
        </div>
        <div class="col-span-6 md:col-span-1">
          <label class="text-xs text-neutral-500">% A</label>
          <input id="iPercA" type="number" step="0.01" min="0" max="1" class="input" value="0.5" />
        </div>
        <div class="col-span-6 md:col-span-1">
          <label class="text-xs text-neutral-500">% B</label>
          <input id="iPercB" type="number" step="0.01" min="0" max="1" class="input" value="0.5" />
        </div>
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Tipo Doc</label>
          <select id="iTipoDoc" class="select" aria-label="Tipo de Documento"></select>
        </div>
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Nº Doc</label>
          <input id="iNumDoc" class="input" placeholder="ID/NSU/Nota" />
        </div>
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Forma Pgto</label>
          <select id="iForma" class="select" aria-label="Forma de Pagamento"></select>
        </div>
        <div class="col-span-12 md:col-span-2">
          <label class="text-xs text-neutral-500">Status</label>
          <select id="iStatus" class="select" aria-label="Status"></select>
        </div>
        <div class="col-span-12 md:col-span-4">
          <label class="text-xs text-neutral-500">Comprovante (URL)</label>
          <input id="iLink" class="input" placeholder="https://..." />
        </div>
        <div class="col-span-12">
          <label class="text-xs text-neutral-500">Observações</label>
          <input id="iObs" class="input" placeholder="Notas adicionais" />
        </div>
      </div>
      <div class="mt-4 flex gap-2 items-center">
        <button id="btnAdd" class="btn btn-prim">Adicionar</button>
        <button id="btnAddTerreno" class="btn btn-sec">Lançar Terreno (R$ 45.000 – Victor)</button>
        <span id="formMsg" class="hint"></span>
      </div>
    </section>

    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
      <div class="card lg:col-span-2 overflow-x-auto">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-lg font-semibold">Lançamentos</h2>
          <div class="text-sm text-neutral-500">Sem anexo, sem reembolso.</div>
        </div>
        <table class="w-full tbl">
          <thead>
            <tr class="border-b">
              <th>Data</th>
              <th>Descrição</th>
              <th>Categoria</th>
              <th>Centro</th>
              <th class="text-right">Valor</th>
              <th>Pagador</th>
              <th class="text-center">%A</th>
              <th class="text-center">%B</th>
              <th>Tipo Doc</th>
              <th>Nº Doc</th>
              <th>Forma</th>
              <th>Status</th>
              <th>Comprovante</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="tBody"></tbody>
        </table>
      </div>

      <div class="card">
        <h2 class="text-lg font-semibold mb-3">Acertos (transferências)</h2>
        <div class="grid grid-cols-2 gap-3 mb-3">
          <div>
            <label class="text-xs text-neutral-500">De</label>
            <select id="accDe" class="select"></select>
          </div>
          <div>
            <label class="text-xs text-neutral-500">Para</label>
            <select id="accPara" class="select"></select>
          </div>
          <div class="col-span-2">
            <label class="text-xs text-neutral-500">Valor (R$)</label>
            <input id="accValor" type="text" inputmode="decimal" class="input" placeholder="Ex.: 22.500,00" />
          </div>
          <div class="col-span-2">
            <label class="text-xs text-neutral-500">Link do comprovante</label>
            <input id="accLink" class="input" placeholder="https://..." />
          </div>
        </div>
        <div class="flex gap-2 mb-4">
          <button id="btnAddAcc" class="btn btn-prim">Registrar Acerto</button>
          <button id="btnSugestao" class="btn btn-sec">Usar Sugestão</button>
        </div>
        <div>
          <h3 class="text-sm font-semibold mb-2">Histórico</h3>
          <ul id="accList" class="space-y-2 text-sm"></ul>
        </div>
      </div>
    </section>

    <section class="card">
      <h2 class="text-lg font-semibold mb-3">Resumo</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <div class="text-xs text-neutral-500">Total Geral</div>
          <div id="rTotal" class="text-xl font-bold">R$ 0,00</div>
        </div>
        <div>
          <div class="text-xs text-neutral-500">Devido (50%) — <span id="lblA2">Victor</span></div>
          <div id="rDevA" class="text-xl font-bold">R$ 0,00</div>
        </div>
        <div>
          <div class="text-xs text-neutral-500">Devido (50%) — <span id="lblB2">Gustavo</span></div>
          <div id="rDevB" class="text-xl font-bold">R$ 0,00</div>
        </div>
        <div>
          <div class="text-xs text-neutral-500">Pago — <span id="lblA3">Victor</span></div>
          <div id="rPagoA" class="text-xl font-bold">R$ 0,00</div>
        </div>
        <div>
          <div class="text-xs text-neutral-500">Pago — <span id="lblB3">Gustavo</span></div>
          <div id="rPagoB" class="text-xl font-bold">R$ 0,00</div>
        </div>
        <div>
          <div class="text-xs text-neutral-500">Saldo — <span id="lblA4">Victor</span> (pós-acertos)</div>
          <div id="rSaldoA" class="text-xl font-bold">R$ 0,00</div>
        </div>
        <div>
          <div class="text-xs text-neutral-500">Saldo — <span id="lblB4">Gustavo</span> (pós-acertos)</div>
          <div id="rSaldoB" class="text-xl font-bold">R$ 0,00</div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ===== Helpers =====
    const $ = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>Array.from(document.querySelectorAll(sel));
    const toBRL = (n)=> Number(n||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
    const round2 = (x)=> Math.round((Number(x)||0) * 100) / 100;
    // Aceita "1.234,56" ou "1234.56"
    const parseMoney = (v)=>{
      if(v==null) return 0;
      const s = String(v).trim();
      if(!s) return 0;
      // remove espaços e símbolos
      const clean = s.replace(/[^0-9.,-]/g,'').replace(/(,)(?=.*,)/g,'');
      // se tem vírgula como decimal, troca por ponto
      const normalized = clean.replace(',', '.');
      const num = parseFloat(normalized);
      return isNaN(num)?0:num;
    };
    const pctClamp = (x)=>{
      const n = Number(x);
      if(isNaN(n)) return 0.5;
      return Math.min(1, Math.max(0, n));
    };

    const LS_KEY = 'rateio50_v1';

    const state = {
      a: 'Victor',
      b: 'Gustavo',
      lanc: [], // {id, dt, desc, cat, cc, valor, pagador, pA, pB, tipo, num, forma, status, link, obs}
      acertos: [] // {id, de, para, valor, link, dt}
    };

    const CATS = ["Terreno","Projeto","Material","Mão de Obra","Serviços","Licenças/Taxas","Transporte/Logística","Outros"];
    const CC = ["Terreno","Projeto","Fundações","Estrutura/Alvenaria","Cobertura","Elétrica","Hidráulica","Revestimentos/Pisos","Esquadrias/Vidros","Pintura","Paisagismo","Licenças/Taxas","Equalização","Outros"];
    const TIPODOC = ["NF-e (produto)","NFS-e (serviço)","Recibo","RPA","Sem documento"];
    const FORMA = ["PIX","Cartão (crédito)","Cartão (débito)","Boleto","Dinheiro","Transferência"];
    const STATUS = ["Aguardando aprovação","Aprovado","Pago","Conciliado","Reembolsado"];

    // ===== Persistence =====
    function save(){ try{ localStorage.setItem(LS_KEY, JSON.stringify(state)); }catch(e){ alert('Erro ao salvar no navegador.'); console.error(e);} }
    function load(){ try{ const s = localStorage.getItem(LS_KEY); if(s){ const obj = JSON.parse(s); if(obj && typeof obj==='object'){ Object.assign(state, obj); } } }catch(e){ console.error(e);} }

    // ===== UI helpers =====
    function fillSelect(sel, arr){ sel.innerHTML = arr.map(v=>`<option value="${v}">${v}</option>`).join(''); }
    function refreshLabels(){
      $$("#lblA, #lblA2, #lblA3, #lblA4").forEach(n=>n.textContent = state.a);
      $$("#lblB, #lblB2, #lblB3, #lblB4").forEach(n=>n.textContent = state.b);
      fillSelect($('#iPagador'), [state.a, state.b]);
      fillSelect($('#accDe'), [state.a, state.b]);
      fillSelect($('#accPara'), [state.a, state.b]);
    }

    // ===== Rendering =====
    function renderTable(){
      const tb = $('#tBody'); tb.innerHTML = '';
      // ordena por data crescente; itens sem data no final
      const rows = [...state.lanc].sort((a,b)=>{
        if(!a.dt && !b.dt) return 0;
        if(!a.dt) return 1; if(!b.dt) return -1;
        return a.dt.localeCompare(b.dt);
      });
      rows.forEach((r)=>{
        const tr = document.createElement('tr'); tr.className='border-b hover:bg-neutral-50';
        const pA = (r.pA??0.5), pB = (r.pB??0.5);
        tr.innerHTML = `
          <td>${r.dt||''}</td>
          <td>${r.desc||''}</td>
          <td><span class="pill bg-neutral-100">${r.cat||''}</span></td>
          <td>${r.cc||''}</td>
          <td class="text-right">${toBRL(r.valor||0)}</td>
          <td>${r.pagador||''}</td>
          <td class="text-center">${Math.round(pA*100)}%</td>
          <td class="text-center">${Math.round(pB*100)}%</td>
          <td>${r.tipo||''}</td>
          <td>${r.num||''}</td>
          <td>${r.forma||''}</td>
          <td>${r.status||''}</td>
          <td>${r.link?`<a class='text-blue-700 underline' href='${r.link}' target='_blank' rel='noopener'>abrir</a>`:''}</td>
          <td><button data-id="${r.id}" class="btn btn-sec text-xs" title="Excluir lançamento">Excluir</button></td>
        `;
        tb.appendChild(tr);
      });
      // delete handlers
      $$('#tBody button[data-id]').forEach(b=> b.onclick = ()=>{ const id=b.getAttribute('data-id'); state.lanc = state.lanc.filter(x=>x.id!==id); save(); compute(); });
    }

    function renderAcertos(){
      const ul = $('#accList'); ul.innerHTML = '';
      // ordena por data
      const rows = [...state.acertos].sort((a,b)=>{
        if(!a.dt && !b.dt) return 0;
        if(!a.dt) return 1; if(!b.dt) return -1;
        return String(a.dt).localeCompare(String(b.dt));
      });
      rows.forEach(a=>{
        const li = document.createElement('li');
        li.innerHTML = `<div class='flex items-center justify-between'>
          <div><span class='tag'>${a.dt||''}</span> <b>${a.de}</b> → <b>${a.para}</b> • ${toBRL(a.valor)} ${a.link?`• <a class='text-blue-700 underline' href='${a.link}' target='_blank' rel='noopener'>comprovante</a>`:''}</div>
          <button data-id='${a.id}' class='btn btn-sec text-xs' title='Excluir acerto'>Excluir</button>
        </div>`;
        ul.appendChild(li);
      });
      $$('#accList button[data-id]').forEach(b=> b.onclick = ()=>{ const id=b.getAttribute('data-id'); state.acertos = state.acertos.filter(x=>x.id!==id); save(); compute(); });
    }

    // ===== Core calc =====
    function compute(){
      const total = round2(state.lanc.reduce((s,r)=> s + parseMoney(r.valor), 0));
      const pagoA = round2(state.lanc.filter(r=>r.pagador===state.a).reduce((s,r)=> s+parseMoney(r.valor), 0));
      const pagoB = round2(state.lanc.filter(r=>r.pagador===state.b).reduce((s,r)=> s+parseMoney(r.valor), 0));
      const devA = round2(state.lanc.reduce((s,r)=> s + parseMoney(r.valor)*(r.pA!=null?pctClamp(r.pA):0.5), 0));
      const devB = round2(state.lanc.reduce((s,r)=> s + parseMoney(r.valor)*(r.pB!=null?pctClamp(r.pB):0.5), 0));

      const saldoA_bruto = round2(pagoA - devA);
      const saldoB_bruto = round2(pagoB - devB);

      const recA = round2(state.acertos.filter(a=>a.para===state.a).reduce((s,a)=> s+parseMoney(a.valor),0));
      const pagA = round2(state.acertos.filter(a=>a.de===state.a).reduce((s,a)=> s+parseMoney(a.valor),0));
      const recB = round2(state.acertos.filter(a=>a.para===state.b).reduce((s,a)=> s+parseMoney(a.valor),0));
      const pagB = round2(state.acertos.filter(a=>a.de===state.b).reduce((s,a)=> s+parseMoney(a.valor),0));

      const saldoA = round2(saldoA_bruto + recA - pagA);
      const saldoB = round2(saldoB_bruto + recB - pagB);

      let sugerido = 0; let quemPaga = '';
      if (saldoA > 0 && saldoB < 0) { sugerido = Math.min(saldoA, -saldoB); quemPaga = state.b; }
      else if (saldoB > 0 && saldoA < 0) { sugerido = Math.min(saldoB, -saldoA); quemPaga = state.a; }

      // KPIs
      $('#kpiTotal').textContent = toBRL(total);
      $('#kpiPagoA').textContent = toBRL(pagoA);
      $('#kpiPagoB').textContent = toBRL(pagoB);
      $('#kpiEqual').textContent = toBRL(sugerido);
      $('#whoPays').textContent = quemPaga||'';

      // Resumo
      $('#rTotal').textContent = toBRL(total);
      $('#rDevA').textContent = toBRL(devA);
      $('#rDevB').textContent = toBRL(devB);
      $('#rPagoA').textContent = toBRL(pagoA);
      $('#rPagoB').textContent = toBRL(pagoB);
      $('#rSaldoA').textContent = toBRL(saldoA);
      $('#rSaldoB').textContent = toBRL(saldoB);

      save(); renderTable(); renderAcertos();
    }

    // ===== Mutations =====
    function uuid(){ return (crypto && crypto.randomUUID)? crypto.randomUUID(): (Date.now().toString(36)+Math.random().toString(36).slice(2)); }
    function addLancamento(obj){
      const rec = {
        id: uuid(),
        dt: obj.dt || new Date().toISOString().slice(0,10),
        desc: (obj.desc||'').trim(),
        cat: obj.cat || 'Outros',
        cc: obj.cc || 'Outros',
        valor: round2(parseMoney(obj.valor)),
        pagador: obj.pagador || state.a,
        pA: pctClamp(obj.pA!=null?obj.pA:0.5),
        pB: pctClamp(obj.pB!=null?obj.pB:0.5),
        tipo: obj.tipo || '',
        num: obj.num || '',
        forma: obj.forma || '',
        status: obj.status || '',
        link: obj.link || '',
        obs: obj.obs || ''
      };
      if(!rec.desc){ msg('Informe a descrição', true); return; }
      if(!rec.valor || rec.valor<=0){ msg('Valor deve ser positivo', true); return; }
      if(rec.pA+rec.pB>1.0001){ msg('Soma de %A + %B não pode exceder 1.0', true); return; }
      state.lanc.push(rec); save(); compute(); msg('Lançamento adicionado');
    }

    function addAcerto(obj){
      const valor = round2(parseMoney(obj.valor));
      const de = obj.de, para = obj.para;
      if(!valor || valor<=0){ alert('Valor do acerto deve ser positivo.'); return; }
      if(!de || !para || de===para){ alert('Participantes inválidos.'); return; }
      state.acertos.push({ id: uuid(), de, para, valor, link: (obj.link||''), dt: new Date().toISOString().slice(0,10) });
      save(); compute();
    }

    // ===== CSV =====
    function exportCSV(){
      const esc = (v)=>`"${String(v??'').replaceAll('"','""')}"`;
      const head = ["dt","desc","cat","cc","valor","pagador","pA","pB","tipo","num","forma","status","link","obs"];
      const rows = state.lanc.map(r=> head.map(k=> esc(r[k])).join(','));
      const csv = [head.join(','), ...rows].join('
');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'lancamentos.csv'; a.click();
    }

    function importCSV(file){
      const reader = new FileReader();
      reader.onload = ()=>{
        const text = reader.result; if(!text) return;
        const lines = String(text).split(/
?
/).filter(Boolean);
        if(!lines.length) return;
        const head = lines.shift().split(',').map(h=>h.replaceAll('"','').trim());
        const to = (s)=> String(s||'').replace(/^\"|\"$/g,'').replaceAll('""','"');
        lines.forEach(line=>{
          const cells = line.match(/(?:\"[^\"]*\"|[^,])+/g) || [];
          const rec = {}; head.forEach((h,i)=> rec[h] = to(cells[i]||''));
          addLancamento(rec); // já valida e normaliza
        });
      };
      reader.readAsText(file, 'utf-8');
    }

    // ===== UX =====
    function msg(text, isError=false){
      const el = $('#formMsg');
      el.textContent = text;
      el.className = `hint ${isError? 'danger':''}`;
      if(text) setTimeout(()=>{ el.textContent=''; el.className='hint'; }, 2500);
    }

    function init(){
      // selects
      fillSelect($('#iCat'), CATS); fillSelect($('#iCC'), CC); fillSelect($('#iTipoDoc'), TIPODOC);
      fillSelect($('#iForma'), FORMA); fillSelect($('#iStatus'), STATUS);

      load();
      $('#nameA').value = state.a; $('#nameB').value = state.b; refreshLabels();
      // default data hoje
      if($('#iData') && !$('#iData').value){ $('#iData').value = new Date().toISOString().slice(0,10); }

      // listeners
      $('#nameA').oninput = ()=>{ state.a = $('#nameA').value||'A'; refreshLabels(); compute(); };
      $('#nameB').oninput = ()=>{ state.b = $('#nameB').value||'B'; refreshLabels(); compute(); };

      $('#btnAdd').onclick = ()=>{
        addLancamento({
          dt: $('#iData').value,
          desc: $('#iDesc').value,
          cat: $('#iCat').value,
          cc: $('#iCC').value,
          valor: $('#iValor').value,
          pagador: $('#iPagador').value,
          pA: $('#iPercA').value,
          pB: $('#iPercB').value,
          tipo: $('#iTipoDoc').value,
          num: $('#iNumDoc').value,
          forma: $('#iForma').value,
          status: $('#iStatus').value,
          link: $('#iLink').value,
          obs: $('#iObs').value
        });
        $$('#iDesc,#iValor,#iNumDoc,#iLink,#iObs').forEach(i=> i.value='');
      };

      $('#btnAddTerreno').onclick = ()=>{
        const hoje = new Date().toISOString().slice(0,10);
        addLancamento({dt:hoje,desc:'Entrada terreno QD31 LT32',cat:'Terreno',cc:'Terreno',valor:'5.000,00',pagador:state.a,pA:0.5,pB:0.5,tipo:'Recibo',num:'PIX',forma:'PIX',status:'Conciliado',link:'',obs:'Entrada já paga'});
        addLancamento({dt:hoje,desc:'Quitação terreno QD31 LT32',cat:'Terreno',cc:'Terreno',valor:'40.000,00',pagador:state.a,pA:0.5,pB:0.5,tipo:'Recibo',num:'PIX',forma:'PIX',status:'Conciliado',link:'',obs:'Quitação já paga'});
      };

      $('#btnAddAcc').onclick = ()=>{
        const de = $('#accDe').value, para = $('#accPara').value; const v = $('#accValor').value;
        if(!v || parseMoney(v)<=0 || de===para){ alert('Verifique valor e participantes.'); return; }
        addAcerto({de, para, valor:v, link: $('#accLink').value});
        $('#accValor').value=''; $('#accLink').value='';
      };

      $('#btnSugestao').onclick = ()=>{
        const eq = $('#kpiEqual').textContent; const quem = $('#whoPays').textContent;
        const v = prompt(`Transferência sugerida (de ${quem}):`, eq.replace(/[^0-9,.,-]/g,''));
        const num = parseMoney(v);
        if(num>0 && quem){ addAcerto({de: quem, para: (quem===state.a?state.b:state.a), valor: num, link:''}); }
      };

      $('#btnExportCSV').onclick = exportCSV;
      $('#fileImport').onchange = (e)=>{ if(e.target.files[0]) importCSV(e.target.files[0]); };
      $('#btnReset').onclick = ()=>{ if(confirm('Apagar dados locais?')){ localStorage.removeItem(LS_KEY); location.reload(); } };

      compute();
    }

    init();
  </script>
</body>
</html>
